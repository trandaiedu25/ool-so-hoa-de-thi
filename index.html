<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRANDAIEDU - ChuyÃªn Ä‘á» NguyÃªn HÃ m TÃ­ch PhÃ¢n</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel Ä‘á»ƒ biÃªn dá»‹ch JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- KaTeX cho cÃ´ng thá»©c toÃ¡n há»c -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDK (Modular) - Sáº½ import trong module script -->
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .katex { font-size: 1.1em; }
        .math-content img { max-width: 100%; height: auto; display: block; margin: 10px auto; }
        /* Hiá»‡u á»©ng loading */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 30px;
            height: 30px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- Cáº¤U HÃŒNH FIREBASE ---
        // Báº N Cáº¦N THAY THáº¾ Báº°NG CONFIG Cá»¦A RIÃŠNG Báº N Tá»ª GITHUB SECRETS HOáº¶C TRá»°C TIáº¾P
        // Äá»ƒ an toÃ n trÃªn GitHub Pages cÃ´ng khai, báº¡n nÃªn giá»›i háº¡n domain trong Firebase Console
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY_HERE",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // App ID dÃ¹ng chung cho DB
        const appId = "trandaiedu-quiz-app"; 

        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        // --- ICONS (Lucide React khÃ´ng cháº¡y trá»±c tiáº¿p qua CDN dá»… dÃ ng, ta dÃ¹ng tháº» i hoáº·c svg tay náº¿u cáº§n, 
        // hoáº·c dÃ¹ng thÆ° viá»‡n lucide-react qua UMD náº¿u cÃ³. á» Ä‘Ã¢y ta dÃ¹ng text hoáº·c svg Ä‘Æ¡n giáº£n thay tháº¿ Ä‘á»ƒ cháº¡y ngay)
        const Icon = ({ name, size=24, className }) => {
             // Äá»ƒ Ä‘Æ¡n giáº£n hÃ³a cho báº£n single file, ta dÃ¹ng text emoji hoáº·c icon unicode táº¡m thá»i
             // Trong dá»± Ã¡n thá»±c táº¿, báº¡n nÃªn build tá»« React project chuáº©n
             const icons = {
                 user: 'ğŸ‘¤', lock: 'ğŸ”’', book: 'ğŸ“š', check: 'âœ…', x: 'âŒ', 
                 trophy: 'ğŸ†', save: 'ğŸ’¾', logout: 'ğŸšª', list: 'ğŸ“‹', 
                 type: 'âŒ¨ï¸', wifi: 'ğŸ“¶', wifioff: 'ğŸ“´', alert: 'âš ï¸',
                 loader: 'â³', retry: 'ğŸ”„', eyeoff: 'ğŸ™ˆ'
             };
             return <span className={`text-xl ${className}`} style={{fontSize: size}}>{icons[name] || '?'}</span>;
        };


        // --- UTILS: MATH RENDERER ---
        const MathText = ({ text, className = "" }) => {
            const containerRef = useRef(null);

            useEffect(() => {
                if (containerRef.current && text) {
                    // Render KaTeX
                    renderMathInElement(containerRef.current, {
                        delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "$", right: "$", display: false}
                        ],
                        throwOnError: false
                    });
                }
            }, [text]);

            return <span ref={containerRef} className={className} dangerouslySetInnerHTML={{__html: text}} />;
        };

        // --- HÃŒNH áº¢NH SVG ---
        const ParabolImage = () => (
            <div className="flex justify-center my-4">
                <svg width="200" height="150" viewBox="-50 -10 100 80" className="border border-gray-200 bg-white rounded shadow-sm">
                    <path d="M -40 70 Q 0 -10 40 70" fill="none" stroke="#2563eb" strokeWidth="2" />
                    <line x1="-40" y1="70" x2="40" y2="70" stroke="black" strokeWidth="1" />
                    <line x1="0" y1="0" x2="0" y2="70" stroke="black" strokeWidth="1" strokeDasharray="4" />
                    <text x="-5" y="75" fontSize="8" textAnchor="middle">0</text>
                    <text x="0" y="-2" fontSize="8" textAnchor="middle">h = 2.25m</text>
                    <text x="0" y="85" fontSize="8" textAnchor="middle">w = 3m</text>
                </svg>
            </div>
        );

        const MachinePartImage = () => (
            <div className="flex justify-center my-4">
                <svg width="200" height="100" viewBox="0 0 200 100" className="border border-gray-200 bg-white rounded shadow-sm">
                    <ellipse cx="30" cy="50" rx="10" ry="30" fill="none" stroke="black" />
                    <ellipse cx="170" cy="50" rx="10" ry="30" fill="none" stroke="black" />
                    <line x1="30" y1="20" x2="170" y2="20" stroke="black" strokeWidth="2" />
                    <line x1="30" y1="80" x2="170" y2="80" stroke="black" strokeWidth="2" />
                    <path d="M 30 20 Q 100 50 170 20" fill="none" stroke="#2563eb" strokeDasharray="4" />
                    <text x="100" y="95" fontSize="10" textAnchor="middle">Chi tiáº¿t mÃ¡y</text>
                </svg>
            </div>
        );
        
        const ThuanhImage = () => (
          <svg width="600" height="400" viewBox="0 0 500 350" xmlns="http://www.w3.org/2000/svg" className="max-w-full h-auto border rounded bg-white">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="black" />
                </marker>
            </defs>
            <rect width="100%" height="100%" fill="white" />
            <path d="M 50 160 C 150 160, 250 220, 350 220 L 350 250 C 250 250, 150 190, 50 190 Z" fill="#87CEFA" stroke="none" />
            <rect x="50" y="160" width="300" height="90" fill="none" stroke="#4682B4" strokeWidth="2" />
            <line x1="50" y1="250" x2="400" y2="250" stroke="black" strokeWidth="2" markerEnd="url(#arrowhead)" />
            <line x1="50" y1="250" x2="50" y2="100" stroke="black" strokeWidth="2" markerEnd="url(#arrowhead)" />
            <path d="M 50 160 C 150 160, 250 220, 350 220" fill="none" stroke="black" strokeWidth="1.5" />
            <path d="M 50 190 C 150 190, 250 250, 350 250" fill="none" stroke="black" strokeWidth="1.5" />
            <text x="250" y="300" fontFamily="serif" fontSize="18" textAnchor="middle">HÃ¬nh minh há»a hoa vÄƒn</text>
          </svg>
        );


        // --- DATA CÃ‚U Há»I ---
        const QUESTION_BANK = [
             // MÃƒ Äá»€ 145 - Pháº§n 1
            { id: 'd145_q1', type: 'mcq', question: "Há» nguyÃªn hÃ m cá»§a hÃ m sá»‘ $f(x)=3x^2+\\sin 2x$ lÃ :", options: ["$x^3+\\cos 2x+C$", "$6x+2\\cos 2x+C$", "$x^3-\\frac{1}{2}\\cos 2x+C$", "$6x+\\frac{1}{2}\\cos 2x+C$"], correct: 2, explanation: "Ta cÃ³ $\\int (3x^2+\\sin 2x)dx = x^3 - \\frac{1}{2}\\cos 2x + C$." },
            { id: 'd145_q2', type: 'mcq', question: "Má»‡nh Ä‘á» nÃ o sau Ä‘Ã¢y SAI?", options: ["$\\int [f_1(x)+f_2(x)]dx = \\int f_1(x)dx + \\int f_2(x)dx$", "$\\int kf(x)dx = k\\int f(x)dx$ ($k \\ne 0$)", "$\\int f'(x)dx = f(x) + C$", "$\\int [f_1(x).f_2(x)]dx = \\int f_1(x)dx . \\int f_2(x)dx$"], correct: 3, explanation: "NguyÃªn hÃ m cá»§a tÃ­ch khÃ´ng báº±ng tÃ­ch cÃ¡c nguyÃªn hÃ m." },
            // ... (CÃ¡c cÃ¢u há»i khÃ¡c tá»« code cÅ©, copy vÃ o Ä‘Ã¢y)
            // Äá»‚ TIáº¾T KIá»†M KHÃ”NG GIAN, TÃ”I CHá»ˆ Láº¤Y VÃ Dá»¤ Äáº I DIá»†N. 
            // Báº N HÃƒY COPY TOÃ€N Bá»˜ Máº¢NG QUESTION_BANK Tá»ª FILE quiz_app_tde.jsx VÃ€O ÄÃ‚Y
            
             // MÃƒ Äá»€ 215 - TrÃ­ch xuáº¥t cÃ³ hÃ¬nh
            { id: 'd215_q18', type: 'text', question: "TrÆ°á»ng muá»‘n lÃ m cá»­a Parabol cao 2,25m, rá»™ng 3m. GiÃ¡ 1.500.000Ä‘/m2. TÃ­nh sá»‘ tiá»n pháº£i tráº£ (Ä‘Æ¡n vá»‹ nghÃ¬n Ä‘á»“ng).", acceptable: ["6750"], image: <ParabolImage />, explanation: "Diá»‡n tÃ­ch $S = \\frac{2}{3} \\times 3 \\times 2.25 = 4.5 m^2$. Tiá»n = $4.5 \\times 1.500 = 6.750$ (nghÃ¬n Ä‘á»“ng)." },
            
            // MÃƒ Äá»€ 317 - TrÃ­ch xuáº¥t cÃ³ hÃ¬nh
            { id: 'd317_q17', type: 'text', question: "Thá»ƒ tÃ­ch cá»§a chi tiáº¿t mÃ¡y (Ä‘á» 317) báº±ng bao nhiÃªu $cm^3$ (lÃ m trÃ²n káº¿t quáº£ Ä‘áº¿n hÃ ng pháº§n mÆ°á»i)?", acceptable: ["34", "34.0"], image: <MachinePartImage />, explanation: "Dá»±a trÃªn Ä‘Ã¡p Ã¡n trÃ­ch xuáº¥t tá»« tÃ i liá»‡u: 34." }
        ];
        
        // --- LOGIC HÃ€M ---
        const PASSING_SCORE = 6.0;
        
        // (Copy cÃ¡c hÃ m generateRandomQuiz, calculateScore tá»« code cÅ© vÃ o Ä‘Ã¢y)
        const generateRandomQuiz = () => {
             // Demo láº¥y ngáº«u nhiÃªn 5 cÃ¢u náº¿u ngÃ¢n hÃ ng Ã­t, hoáº·c logic full
             return QUESTION_BANK.slice(0, 5); // Táº¡m thá»i láº¥y 5 cÃ¢u Ä‘á»ƒ test
        };

        const calculateScore = (currentQuestions, answers) => {
            let score = 0;
            currentQuestions.forEach(q => {
                if (q.type === 'mcq' && answers[q.id] === q.correct) score += 0.25;
                else if (q.type === 'text' && q.acceptable.includes((answers[q.id] || "").trim())) score += 0.5;
                else if (q.type === 'group_tf') { /* Logic TF */ }
            });
            return score > 10 ? 10 : score; // Demo logic
        };


        // --- COMPONENTS ---
        const WelcomeScreen = ({ onSelectMode }) => (
            <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-cyan-600 to-blue-800 p-4 text-white">
                <div className="bg-white/10 backdrop-blur-md p-8 rounded-2xl shadow-2xl max-w-md w-full text-center border border-white/20">
                    <h1 className="text-4xl font-bold mb-2">TRANDAIEDU</h1>
                    <h2 className="text-xl mb-8 text-cyan-100 font-medium">CHUYÃŠN Äá»€ NGUYÃŠN HÃ€M TÃCH PHÃ‚N</h2>
                    <div className="space-y-4">
                        <button onClick={() => onSelectMode('student')} className="w-full py-4 bg-white text-blue-800 rounded-xl font-bold hover:bg-blue-50 transition-all shadow-lg">
                            <Icon name="user"/> Há»c Sinh VÃ o Thi
                        </button>
                        <button onClick={() => onSelectMode('teacher')} className="w-full py-4 bg-blue-900/50 text-white rounded-xl font-bold hover:bg-blue-900 transition-all border border-blue-400/30">
                            <Icon name="lock"/> GiÃ¡o ViÃªn Xem Äiá»ƒm
                        </button>
                    </div>
                </div>
            </div>
        );

        // --- MAIN APP ---
        const App = () => {
            const [view, setView] = useState('welcome');
            const [user, setUser] = useState(null);

            useEffect(() => {
                // Auth áº©n danh Ä‘á»ƒ ghi Ä‘iá»ƒm
                signInAnonymously(auth).catch((error) => {
                    console.warn("Lá»—i Ä‘Äƒng nháº­p áº©n danh:", error);
                });
                
                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    if (u) setUser(u);
                });
                return () => unsubscribe();
            }, []);

            return (
                <div>
                    {view === 'welcome' && <WelcomeScreen onSelectMode={(mode) => setView(mode === 'student' ? 'quiz' : 'teacher')} />}
                    {view === 'quiz' && <div className="text-center p-10">Pháº§n thi tráº¯c nghiá»‡m (Copy code QuizView vÃ o Ä‘Ã¢y)...</div>}
                    {view === 'teacher' && <div className="text-center p-10">Pháº§n giÃ¡o viÃªn (Copy code TeacherDashboard vÃ o Ä‘Ã¢y)...</div>}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
