<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·ªÅ Thi Th·ª≠ T·ªët Nghi·ªáp THPT 2025 - M√¥n To√°n - ƒê·ªÅ S·ªë 01</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .katex { font-size: 1.1em; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        /* Custom scrollbar for tables */
        .overflow-x-auto::-webkit-scrollbar { height: 8px; }
        .overflow-x-auto::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        // --- C·∫§U H√åNH FIREBASE ---
        const USER_CONFIG = {
            apiKey: "AIzaSyCEgOrAaEHjZbhYTSkVHGRkGa8WfjjnWvg",
            authDomain: "trandaiedu-39df1.firebaseapp.com",
            projectId: "trandaiedu-39df1",
            storageBucket: "trandaiedu-39df1.firebasestorage.app",
            messagingSenderId: "286264195114",
            appId: "1:286264195114:web:c6ca2fe8e1b3e7e25ceb53"
        };

        let db = null;
        let auth = null;
        const COLLECTION_NAME = "quiz_results_math12_thpt2025_de01_full";

        const initializeFirebase = () => {
            try {
                if (!window.firebase) return false;
                if (firebase.apps.length === 0) firebase.initializeApp(USER_CONFIG);
                auth = firebase.auth();
                db = firebase.firestore();
                return true;
            } catch (e) { console.error(e); return false; }
        };
        initializeFirebase();

        // --- COMPONENTS H·ªñ TR·ª¢ ---
        const Icon = ({ name, size=24, className="" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                   const iconElement = window.lucide.icons[name];
                   if(iconElement) iconRef.current.innerHTML = iconElement.toSvg({ class: className, width: size, height: size });
                }
            }, [name, size, className]);
            return <span ref={iconRef} className={className} style={{display: 'inline-flex', alignItems: 'center'}}></span>;
        };

        const MathText = ({ text, className = "" }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (containerRef.current && text && window.renderMathInElement) {
                    renderMathInElement(containerRef.current, {
                        delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "$", right: "$", display: false},
                            {left: "\\(", right: "\\)", display: false},
                            {left: "\\[", right: "\\]", display: true}
                        ],
                        throwOnError: false
                    });
                }
            }, [text]);
            return <span ref={containerRef} className={className} dangerouslySetInnerHTML={{__html: text}} />;
        };

        // --- H√åNH ·∫¢NH & B·∫¢NG BI·ªÇU (Chuy·ªÉn t·ª´ HTML g·ªëc sang React Component) ---
        
        // C√¢u 1 Ph·∫ßn I: B·∫£ng bi·∫øn thi√™n
        const TablePart1Q1 = () => (
            <div className="flex justify-center my-4 overflow-x-auto">
                <svg width="400" height="150" viewBox="0 0 400 150" className="bg-white rounded shadow-sm border border-gray-200 min-w-[400px]">
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                        </marker>
                    </defs>
                    {/* Lines */}
                    <line x1="50" y1="0" x2="50" y2="150" stroke="#000" strokeWidth="1"/>
                    <line x1="0" y1="40" x2="400" y2="40" stroke="#000" strokeWidth="1"/>
                    <line x1="0" y1="80" x2="400" y2="80" stroke="#000" strokeWidth="1"/>
                    
                    {/* Text Row 1: x */}
                    <text x="25" y="25" fontFamily="Arial" fontSize="14">x</text>
                    <text x="80" y="25" fontFamily="Arial" fontSize="14">-‚àû</text>
                    <text x="180" y="25" fontFamily="Arial" fontSize="14">-1</text>
                    <text x="280" y="25" fontFamily="Arial" fontSize="14">1</text>
                    <text x="370" y="25" fontFamily="Arial" fontSize="14">+‚àû</text>

                    {/* Text Row 2: y' */}
                    <text x="10" y="65" fontFamily="Arial" fontSize="14">y'</text>
                    <text x="130" y="65" fontFamily="Arial" fontSize="14">+</text>
                    <text x="180" y="65" fontFamily="Arial" fontSize="14">0</text>
                    <text x="230" y="65" fontFamily="Arial" fontSize="14">-</text>
                    <text x="280" y="65" fontFamily="Arial" fontSize="14">0</text>
                    <text x="330" y="65" fontFamily="Arial" fontSize="14">+</text>

                    {/* Text Row 3: y */}
                    <text x="10" y="115" fontFamily="Arial" fontSize="14">y</text>
                    
                    {/* Graph lines */}
                    <path d="M70,130 L170,95" stroke="#000" fill="none" markerEnd="url(#arrow)"/>
                    <path d="M190,95 L270,130" stroke="#000" fill="none" markerEnd="url(#arrow)"/>
                    <path d="M290,130 L380,95" stroke="#000" fill="none" markerEnd="url(#arrow)"/>
                    
                    {/* Values in y */}
                    <text x="60" y="135" fontFamily="Arial" fontSize="12">-‚àû</text>
                    <text x="175" y="90" fontFamily="Arial" fontSize="12">2</text>
                    <text x="275" y="140" fontFamily="Arial" fontSize="12">-2</text>
                    <text x="380" y="90" fontFamily="Arial" fontSize="12">+‚àû</text>
                </svg>
            </div>
        );

        // C√¢u 3 Ph·∫ßn I: B·∫£ng s·ªë li·ªáu
        const TablePart1Q3 = () => (
            <div className="my-4 overflow-x-auto">
                <table className="min-w-full border border-collapse border-gray-300 text-sm text-center">
                    <thead>
                        <tr className="bg-gray-100">
                            <th className="border border-gray-300 p-2 font-bold">Th·ªùi gian</th>
                            <th className="border border-gray-300 p-2">[0; 20)</th>
                            <th className="border border-gray-300 p-2">[20; 40)</th>
                            <th className="border border-gray-300 p-2">[40; 60)</th>
                            <th className="border border-gray-300 p-2">[60; 80)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th className="border border-gray-300 p-2 bg-gray-50 font-bold">S·ªë HS</th>
                            <td className="border border-gray-300 p-2">5</td>
                            <td className="border border-gray-300 p-2">12</td>
                            <td className="border border-gray-300 p-2">18</td>
                            <td className="border border-gray-300 p-2">5</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        );

        // C√¢u 2 Ph·∫ßn III: C·ªïng Parabol
        const ParabolPart3Q2 = () => (
            <div className="flex justify-center my-4">
                <svg width="200" height="200" viewBox="-3 -5 6 6" className="bg-white rounded shadow-sm border border-gray-200">
                    <path d="M -2 0 Q 0 8 2 0" fill="none" stroke="black" strokeWidth="0.1" />
                    <line x1="-3" y1="0" x2="3" y2="0" stroke="black" strokeWidth="0.05" />
                    <line x1="0" y1="0" x2="0" y2="4" stroke="black" strokeWidth="0.05" strokeDasharray="0.1, 0.1" />
                    <circle cx="0" cy="3.75" r="0.1" fill="yellow" stroke="orange" strokeWidth="0.05" />
                    <text x="0.2" y="2" fontSize="0.5" fill="black">h=4m</text>
                    <text x="-1" y="-0.5" fontSize="0.5" fill="black">w=4m</text>
                </svg>
            </div>
        );

        // --- NG√ÇN H√ÄNG C√ÇU H·ªéI (D·ªØ li·ªáu t·ª´ N·ªòI DUNG TEXT) ---
        const QUESTION_BANK = [
            // --- PH·∫¶N I ---
            { 
                id: 'p1_q1', type: 'mcq', 
                question: "Cho h√†m s·ªë $y = f(x)$ c√≥ b·∫£ng bi·∫øn thi√™n nh∆∞ sau. H√†m s·ªë ƒë√£ cho ƒë·ªìng bi·∫øn tr√™n kho·∫£ng n√†o d∆∞·ªõi ƒë√¢y?", 
                image: <TablePart1Q1 />,
                options: ["$(-1; 1)$", "$(1; +\\infty)$", "$(-\\infty; 1)$", "$(-1; 2)$"], 
                correct: 1, // B
                explanation: "Nh√¨n v√†o b·∫£ng bi·∫øn thi√™n, d·∫•u c·ªßa $y'$ d∆∞∆°ng (+) tr√™n kho·∫£ng $(1; +\\infty)$ v√† $(-\\infty; -1)$.<br>H√†m s·ªë ƒë·ªìng bi·∫øn khi $y' > 0$. Do ƒë√≥ h√†m s·ªë ƒë·ªìng bi·∫øn tr√™n $(1; +\\infty)$." 
            },
            { 
                id: 'p1_q2', type: 'mcq', 
                question: "Trong kh√¥ng gian $Oxyz$, cho vect∆° $\\vec{a} = 2\\vec{i} - 3\\vec{j} + \\vec{k}$. T·ªça ƒë·ªô c·ªßa vect∆° $\\vec{a}$ l√†", 
                options: ["$(2; -3; 1)$", "$(2; 3; 1)$", "$(2; -3; 0)$", "$(1; -3; 2)$"], 
                correct: 0, // A
                explanation: "Vect∆° $\\vec{a} = x\\vec{i} + y\\vec{j} + z\\vec{k}$ c√≥ t·ªça ƒë·ªô l√† $(x; y; z)$.<br>V·ªõi $\\vec{a} = 2\\vec{i} - 3\\vec{j} + \\vec{k}$, ta c√≥ t·ªça ƒë·ªô l√† $(2; -3; 1)$." 
            },
            { 
                id: 'p1_q3', type: 'mcq', 
                question: "Cho m·∫´u s·ªë li·ªáu gh√©p nh√≥m v·ªÅ th·ªùi gian t·∫≠p th·ªÉ d·ª•c m·ªói ng√†y (ph√∫t) c·ªßa m·ªôt nh√≥m h·ªçc sinh. Nh√≥m ch·ª©a m·ªët c·ªßa m·∫´u s·ªë li·ªáu tr√™n l√†", 
                image: <TablePart1Q3 />,
                options: ["$[0; 20)$", "$[20; 40)$", "$[40; 60)$", "$[60; 80)$"], 
                correct: 2, // C
                explanation: "Nh√≥m ch·ª©a m·ªët l√† nh√≥m c√≥ t·∫ßn s·ªë l·ªõn nh·∫•t.<br>T·∫ßn s·ªë c√°c nh√≥m l·∫ßn l∆∞·ª£t l√† 5, 12, 18, 5.<br>T·∫ßn s·ªë l·ªõn nh·∫•t l√† 18, t∆∞∆°ng ·ª©ng v·ªõi nh√≥m $[40; 60)$." 
            },
            { 
                id: 'p1_q4', type: 'mcq', 
                question: "Cho c·∫•p s·ªë nh√¢n $(u_n)$ v·ªõi $u_1 = 3$ v√† c√¥ng b·ªôi $q = 2$. Gi√° tr·ªã c·ªßa $u_3$ b·∫±ng", 
                options: ["6", "8", "12", "24"], 
                correct: 2, // C
                explanation: "C√¥ng th·ª©c c·∫•p s·ªë nh√¢n: $u_n = u_1 \\cdot q^{n-1}$.<br>$u_3 = 3 \\cdot 2^{3-1} = 3 \\cdot 2^2 = 3 \\cdot 4 = 12$." 
            },
            { 
                id: 'p1_q5', type: 'mcq', 
                question: "T·∫≠p nghi·ªám c·ªßa b·∫•t ph∆∞∆°ng tr√¨nh $\\log_2(x - 1) < 3$ l√†", 
                options: ["$(-\\infty; 9)$", "$(1; 9)$", "$(1; 7)$", "$(-\\infty; 7)$"], 
                correct: 1, // B
                explanation: "ƒêi·ªÅu ki·ªán: $x - 1 > 0 \\Leftrightarrow x > 1$.<br>B·∫•t ph∆∞∆°ng tr√¨nh: $\\log_2(x - 1) < 3 \\Leftrightarrow x - 1 < 2^3 \\Leftrightarrow x - 1 < 8 \\Leftrightarrow x < 9$.<br>K·∫øt h·ª£p ƒëi·ªÅu ki·ªán, t·∫≠p nghi·ªám l√† $(1; 9)$." 
            },
            { 
                id: 'p1_q6', type: 'mcq', 
                question: "Trong kh√¥ng gian v·ªõi h·ªá t·ªça ƒë·ªô $Oxyz$, ph∆∞∆°ng tr√¨nh n√†o d∆∞·ªõi ƒë√¢y l√† ph∆∞∆°ng tr√¨nh c·ªßa m·∫∑t ph·∫≥ng ƒëi qua ƒëi·ªÉm $M(1; -2; 3)$ v√† c√≥ vect∆° ph√°p tuy·∫øn $\\vec{n} = (2; 1; -1)$?", 
                options: ["$2x + y - z + 3 = 0$", "$x - 2y + 3z + 3 = 0$", "$2x + y - z - 3 = 0$", "$2x + y - z + 5 = 0$"], 
                correct: 0, // A
                explanation: "Ph∆∞∆°ng tr√¨nh m·∫∑t ph·∫≥ng qua $M(x_0; y_0; z_0)$ v·ªõi VTPT $\\vec{n}(a; b; c)$ l√†: $a(x - x_0) + b(y - y_0) + c(z - z_0) = 0$.<br>Thay s·ªë: $2(x - 1) + 1(y + 2) - 1(z - 3) = 0$<br>$\\Leftrightarrow 2x - 2 + y + 2 - z + 3 = 0 \\Leftrightarrow 2x + y - z + 3 = 0$." 
            },
            { 
                id: 'p1_q7', type: 'mcq', 
                question: "Cho hai bi·∫øn c·ªë A v√† B ƒë·ªôc l·∫≠p v·ªõi nhau. Bi·∫øt $P(A) = 0,3$ v√† $P(B) = 0,4$. X√°c su·∫•t c·ªßa bi·∫øn c·ªë $A \\cup B$ l√†", 
                options: ["0,12", "0,7", "0,58", "0,82"], 
                correct: 2, // C
                explanation: "C√¥ng th·ª©c: $P(A \\cup B) = P(A) + P(B) - P(A \\cap B)$.<br>V√¨ A, B ƒë·ªôc l·∫≠p n√™n $P(A \\cap B) = P(A) \\cdot P(B) = 0,3 \\cdot 0,4 = 0,12$.<br>$P(A \\cup B) = 0,3 + 0,4 - 0,12 = 0,58$." 
            },
            { 
                id: 'p1_q8', type: 'mcq', 
                question: "H√†m s·ªë $F(x) = x^2 + \\sin x$ l√† m·ªôt nguy√™n h√†m c·ªßa h√†m s·ªë n√†o d∆∞·ªõi ƒë√¢y?", 
                options: ["$f(x) = 2x + \\cos x$", "$f(x) = 2x - \\cos x$", "$f(x) = \\frac{x^3}{3} - \\cos x$", "$f(x) = x^2 + \\cos x$"], 
                correct: 0, // A
                explanation: "$f(x) = F'(x) = (x^2 + \\sin x)' = 2x + \\cos x$." 
            },
            { 
                id: 'p1_q9', type: 'mcq', 
                question: "ƒê·ªì th·ªã h√†m s·ªë $y = \\frac{2x - 1}{x + 1}$ c√≥ ti·ªám c·∫≠n ƒë·ª©ng l√† ƒë∆∞·ªùng th·∫≥ng", 
                options: ["$x = 2$", "$y = 2$", "$x = -1$", "$y = -1$"], 
                correct: 2, // C
                explanation: "Ti·ªám c·∫≠n ƒë·ª©ng c·ªßa h√†m ph√¢n th·ª©c h·ªØu t·ªâ l√† nghi·ªám c·ªßa m·∫´u s·ªë (n·∫øu kh√¥ng b·ªã tri·ªát ti√™u b·ªüi t·ª≠).<br>$x + 1 = 0 \\Leftrightarrow x = -1$." 
            },
            { 
                id: 'p1_q10', type: 'mcq', 
                question: "Cho h√¨nh ch√≥p S.ABCD c√≥ ƒë√°y ABCD l√† h√¨nh vu√¥ng c·∫°nh $a$, $SA \\perp (ABCD)$ v√† $SA = a\\sqrt{2}$. G√≥c gi·ªØa ƒë∆∞·ªùng th·∫≥ng SC v√† m·∫∑t ph·∫≥ng (ABCD) b·∫±ng", 
                options: ["$30^\\circ$", "$45^\\circ$", "$60^\\circ$", "$90^\\circ$"], 
                correct: 1, // B
                explanation: "H√¨nh chi·∫øu c·ªßa SC l√™n (ABCD) l√† AC (v√¨ $SA \\perp (ABCD)$).<br>G√≥c gi·ªØa SC v√† (ABCD) l√† g√≥c $\\widehat{SCA}$.<br>AC l√† ƒë∆∞·ªùng ch√©o h√¨nh vu√¥ng c·∫°nh $a$ n√™n $AC = a\\sqrt{2}$.<br>Tam gi√°c SAC vu√¥ng t·∫°i A c√≥ $SA = a\\sqrt{2}$, $AC = a\\sqrt{2}$ $\\Rightarrow$ Tam gi√°c SAC vu√¥ng c√¢n t·∫°i A.<br>V·∫≠y $\\widehat{SCA} = 45^\\circ$." 
            },
            { 
                id: 'p1_q11', type: 'mcq', 
                question: "Ph∆∞∆°ng tr√¨nh ƒë∆∞·ªùng ti·ªám c·∫≠n xi√™n c·ªßa ƒë·ªì th·ªã h√†m s·ªë $y = 2x + 1 + \\frac{3}{x-1}$ l√†", 
                options: ["$y = 2x$", "$y = 2x + 1$", "$y = x - 1$", "$x = 1$"], 
                correct: 1, // B
                explanation: "H√†m s·ªë $y = ax + b + g(x)$ v·ªõi $\\lim_{x \\to \\infty} g(x) = 0$ th√¨ $y = ax + b$ l√† ti·ªám c·∫≠n xi√™n.<br>·ªû ƒë√¢y $y = 2x + 1 + \\frac{3}{x-1}$. V√¨ $\\lim_{x \\to \\infty} \\frac{3}{x-1} = 0$ n√™n ti·ªám c·∫≠n xi√™n l√† $y = 2x + 1$." 
            },
            { 
                id: 'p1_q12', type: 'mcq', 
                question: "Cho h√†m s·ªë $y=f(x)$ li√™n t·ª•c tr√™n $\\mathbb{R}$ v√† $\\int_0^2 f(x)dx = 5$, $\\int_2^5 f(x)dx = 3$. T√≠nh $I = \\int_0^5 f(x)dx$.", 
                options: ["$I = 8$", "$I = 2$", "$I = 15$", "$I = -2$"], 
                correct: 0, // A
                explanation: "T√≠nh ch·∫•t c·ªông c·ªßa t√≠ch ph√¢n: $\\int_0^5 f(x)dx = \\int_0^2 f(x)dx + \\int_2^5 f(x)dx$.<br>$I = 5 + 3 = 8$." 
            },

            // --- PH·∫¶N II ---
            {
                id: 'p2_q1', type: 'group_tf',
                question: "Cho h√†m s·ªë $y = \\frac{x^2 - 3x + 3}{x - 1}$ c√≥ ƒë·ªì th·ªã $(C)$.",
                subQuestions: [
                    { id: 'a', text: "T·∫≠p x√°c ƒë·ªãnh c·ªßa h√†m s·ªë l√† $D = \\mathbb{R} \\setminus \\{1\\}$.", correct: true },
                    { id: 'b', text: "ƒê·ªì th·ªã h√†m s·ªë c√≥ ti·ªám c·∫≠n xi√™n l√† ƒë∆∞·ªùng th·∫≥ng $y = x - 2$.", correct: true },
                    { id: 'c', text: "H√†m s·ªë ƒë·∫°t c·ª±c ƒë·∫°i t·∫°i $x = 2$.", correct: false },
                    { id: 'd', text: "ƒê∆∞·ªùng th·∫≥ng $y = -2x + m$ c·∫Øt ƒë·ªì th·ªã $(C)$ t·∫°i hai ƒëi·ªÉm ph√¢n bi·ªát v·ªõi m·ªçi gi√° tr·ªã c·ªßa $m$.", correct: false }
                ],
                explanation: "Ta c√≥: $y = \\frac{x^2 - 3x + 3}{x - 1} = \\frac{(x-1)(x-2) + 1}{x-1} = x - 2 + \\frac{1}{x-1}$.<br>$y' = 1 - \\frac{1}{(x-1)^2} = \\frac{(x-1)^2 - 1}{(x-1)^2} = \\frac{x^2 - 2x}{(x-1)^2}$.<br>$y' = 0 \\Leftrightarrow x = 0$ ho·∫∑c $x = 2$.<br><strong>a) ƒê√∫ng.</strong> ƒêi·ªÅu ki·ªán $x - 1 \\ne 0 \\Rightarrow x \\ne 1$.<br><strong>b) ƒê√∫ng.</strong> D·∫°ng $y = ax+b + \\frac{c}{x-1}$, n√™n TCX l√† $y = x - 2$.<br><strong>c) Sai.</strong> L·∫≠p BBT, t·∫°i $x=2$, $y'=0$ v√† ƒë·ªïi d·∫•u t·ª´ (-) sang (+), n√™n $x=2$ l√† ƒëi·ªÉm c·ª±c ti·ªÉu. C·ª±c ƒë·∫°i t·∫°i $x=0$.<br><strong>d) Sai.</strong> Ph∆∞∆°ng tr√¨nh ho√†nh ƒë·ªô giao ƒëi·ªÉm: $\\frac{x^2 - 3x + 3}{x - 1} = -2x + m \\Leftrightarrow 3x^2 - (5+m)x + (3+m) = 0$ (*).<br>ƒê·ªÉ c·∫Øt t·∫°i 2 ƒëi·ªÉm ph√¢n bi·ªát th√¨ (*) ph·∫£i c√≥ 2 nghi·ªám ph√¢n bi·ªát kh√°c 1.<br>$\\Delta = (5+m)^2 - 12(3+m) = m^2 - 2m - 11$.<br>Ki·ªÉm tra l·∫°i m·ªánh ƒë·ªÅ: 'v·ªõi m·ªçi gi√° tr·ªã c·ªßa m'. N·∫øu $m=1$ th√¨ $\\Delta = 1 - 2 - 11 < 0$, v√¥ nghi·ªám. V·∫≠y √Ω d) l√† <strong>Sai</strong>."
            },
            {
                id: 'p2_q2', type: 'group_tf',
                question: "Trong kh√¥ng gian v·ªõi h·ªá t·ªça ƒë·ªô $Oxyz$, cho 4 ƒëi·ªÉm $A(1; 0; 0)$, $B(0; 2; 0)$, $C(0; 0; 3)$ v√† $D(1; 2; 3)$.",
                subQuestions: [
                    { id: 'a', text: "Vect∆° $\\vec{AB}$ c√≥ t·ªça ƒë·ªô l√† $(-1; 2; 0)$.", correct: true },
                    { id: 'b', text: "Ph∆∞∆°ng tr√¨nh m·∫∑t ph·∫≥ng $(ABC)$ l√† $\\frac{x}{1} + \\frac{y}{2} + \\frac{z}{3} = 1$.", correct: true },
                    { id: 'c', text: "ƒêi·ªÉm $D$ n·∫±m tr√™n m·∫∑t ph·∫≥ng $(ABC)$.", correct: false },
                    { id: 'd', text: "Th·ªÉ t√≠ch kh·ªëi t·ª© di·ªán $OBCD$ b·∫±ng 2 (v·ªõi O l√† g·ªëc t·ªça ƒë·ªô).", correct: false }
                ],
                explanation: "<strong>a) ƒê√∫ng.</strong> $\\vec{AB} = (0-1; 2-0; 0-0) = (-1; 2; 0)$.<br><strong>b) ƒê√∫ng.</strong> Ph∆∞∆°ng tr√¨nh m·∫∑t ph·∫≥ng ch·∫Øn: $\\frac{x}{1} + \\frac{y}{2} + \\frac{z}{3} = 1$.<br><strong>c) Sai.</strong> Thay $D(1;2;3)$ v√†o: $\\frac{1}{1} + \\frac{2}{2} + \\frac{3}{3} = 1 + 1 + 1 = 3 \\ne 1$. D kh√¥ng thu·ªôc (ABC).<br><strong>d) Sai.</strong> Th·ªÉ t√≠ch $V = \\frac{1}{3} \\cdot S_{OBC} \\cdot h = \\frac{1}{3} \\cdot 3 \\cdot 1 = 1$. (Di·ªán t√≠ch OBC = 0.5 * 2 * 3 = 3, chi·ªÅu cao t·ª´ D ƒë·∫øn Oyz l√† 1)."
            },
            {
                id: 'p2_q3', type: 'group_tf',
                question: "M·ªôt c√¥ng ty d·ª± b√°o l·ª£i nhu·∫≠n (ƒë∆°n v·ªã: t·ª∑ ƒë·ªìng) theo th·ªùi gian $t$ (th√°ng) ƒë∆∞·ª£c t√≠nh b·ªüi c√¥ng th·ª©c $P(t) = -t^3 + 12t^2 - 36t + 50$ v·ªõi $0 \\le t \\le 8$.",
                subQuestions: [
                    { id: 'a', text: "L·ª£i nhu·∫≠n c·ªßa c√¥ng ty gi·∫£m trong kho·∫£ng th·ªùi gian t·ª´ th√°ng th·ª© 2 ƒë·∫øn th√°ng th·ª© 6.", correct: false },
                    { id: 'b', text: "L·ª£i nhu·∫≠n ƒë·∫°t gi√° tr·ªã nh·ªè nh·∫•t t·∫°i $t = 6$.", correct: false },
                    { id: 'c', text: "T·ªëc ƒë·ªô tƒÉng tr∆∞·ªüng l·ª£i nhu·∫≠n l·ªõn nh·∫•t t·∫°i th√°ng th·ª© 4.", correct: true },
                    { id: 'd', text: "L·ª£i nhu·∫≠n cao nh·∫•t trong 8 th√°ng ƒë·∫ßu ƒë·∫°t 50 t·ª∑ ƒë·ªìng.", correct: true }
                ],
                explanation: "$P'(t) = -3t^2 + 24t - 36$.<br>$P'(t) = 0 \\Leftrightarrow t^2 - 8t + 12 = 0 \\Leftrightarrow t=2$ ho·∫∑c $t=6$.<br>B·∫£ng bi·∫øn thi√™n tr√™n $[0; 8]$: t: 0 -> 2 (ƒê·ªìng bi·∫øn) -> 6 (Ngh·ªãch bi·∫øn) -> 8 (ƒê·ªìng bi·∫øn).<br>Wait, d·∫•u tam th·ª©c b·∫≠c 2 h·ªá s·ªë √¢m: Trong tr√°i (d∆∞∆°ng), ngo√†i c√πng (√¢m). V·∫≠y: Gi·∫£m tr√™n (0;2), TƒÉng tr√™n (2;6), Gi·∫£m tr√™n (6;8).<br><strong>a) Sai.</strong> Tr√™n (2; 6), $P'(t) > 0$, l·ª£i nhu·∫≠n tƒÉng.<br><strong>b) Sai.</strong> T·∫°i $t=6$ l√† c·ª±c ƒë·∫°i.<br><strong>c) ƒê√∫ng.</strong> T·ªëc ƒë·ªô tƒÉng tr∆∞·ªüng l√† $P'(t)$. Max c·ªßa $P'(t)$ l√† ƒë·ªânh parabol $-3t^2 + 24t - 36$. ƒê·ªânh t·∫°i $t = -b/2a = -24/-6 = 4$.<br><strong>d) ƒê√∫ng.</strong> $P(0)=50, P(2)=18, P(6)=50, P(8)=18$. Max l√† 50."
            },
            {
                id: 'p2_q4', type: 'group_tf',
                question: "Cho hai m·∫´u s·ªë li·ªáu gh√©p nh√≥m v·ªÅ ƒëi·ªÉm thi To√°n c·ªßa l·ªõp 12A v√† 12B nh∆∞ sau: L·ªõp 12A: $S_A^2 = 1,25$, $\\bar{x}_A = 8,0$. L·ªõp 12B: $S_B^2 = 1,80$, $\\bar{x}_B = 7,5$.",
                subQuestions: [
                    { id: 'a', text: "ƒêi·ªÉm trung b√¨nh c·ªßa l·ªõp 12A cao h∆°n l·ªõp 12B.", correct: true },
                    { id: 'b', text: "ƒê·ªô l·ªách chu·∫©n c·ªßa ƒëi·ªÉm thi l·ªõp 12A x·∫•p x·ªâ 1,12.", correct: true },
                    { id: 'c', text: "ƒêi·ªÉm thi c·ªßa h·ªçc sinh l·ªõp 12B ƒë·ªìng ƒë·ªÅu h∆°n l·ªõp 12A.", correct: false },
                    { id: 'd', text: "N·∫øu g·ªôp chung hai l·ªõp (gi·∫£ s·ª≠ sƒ© s·ªë b·∫±ng nhau), ƒëi·ªÉm trung b√¨nh chung l√† 7,75.", correct: true }
                ],
                explanation: "<strong>a) ƒê√∫ng.</strong> $\\bar{x}_A = 8.0 > \\bar{x}_B = 7.5$.<br><strong>b) ƒê√∫ng.</strong> $S_A = \\sqrt{1.25} \\approx 1.118$.<br><strong>c) Sai.</strong> Ph∆∞∆°ng sai $S_B^2 > S_A^2$ (1.8 > 1.25) n√™n ƒë·ªô ph√¢n t√°n l·ªõp B cao h∆°n, nghƒ©a l√† l·ªõp A ƒë·ªìng ƒë·ªÅu h∆°n.<br><strong>d) ƒê√∫ng.</strong> $\\bar{x}_{chung} = \\frac{n\\bar{x}_A + n\\bar{x}_B}{2n} = \\frac{8 + 7.5}{2} = 7.75$."
            },

            // --- PH·∫¶N III ---
            { 
                id: 'p3_q1', type: 'text', 
                question: "M·ªôt ch·∫•t ƒëi·ªÉm chuy·ªÉn ƒë·ªông theo ph∆∞∆°ng tr√¨nh $s(t) = t^3 - 3t^2 + 4t + 1$, trong ƒë√≥ $t$ t√≠nh b·∫±ng gi√¢y, $s$ t√≠nh b·∫±ng m√©t. T√≠nh v·∫≠n t·ªëc c·ªßa ch·∫•t ƒëi·ªÉm t·∫°i th·ªùi ƒëi·ªÉm gia t·ªëc b·∫±ng $0$ $m/s^2$.", 
                acceptable: ["1"], 
                explanation: "V·∫≠n t·ªëc $v(t) = s'(t) = 3t^2 - 6t + 4$.<br>Gia t·ªëc $a(t) = v'(t) = 6t - 6$.<br>Gia t·ªëc b·∫±ng 0 $\\Leftrightarrow 6t - 6 = 0 \\Leftrightarrow t = 1$.<br>Thay $t=1$ v√†o $v(t)$: $v(1) = 3(1)^2 - 6(1) + 4 = 1$ m/s." 
            },
            { 
                id: 'p3_q2', type: 'text', 
                question: "Ng∆∞·ªùi ta mu·ªën thi·∫øt k·∫ø m·ªôt chi·∫øc c·ªïng h√¨nh parabol (nh∆∞ h√¨nh v·∫Ω) c√≥ chi·ªÅu r·ªông ch√¢n c·ªïng l√† 4m v√† chi·ªÅu cao c·ªïng l√† 4m. ƒê·ªÉ trang tr√≠, ng∆∞·ªùi ta treo m·ªôt b√≥ng ƒë√®n t·∫°i ti√™u ƒëi·ªÉm c·ªßa parabol. H·ªèi b√≥ng ƒë√®n c√°ch ƒë·ªânh c·ªïng bao nhi√™u m√©t?", 
                image: <ParabolPart3Q2 />,
                acceptable: ["0.25"], 
                explanation: "G·∫Øn h·ªá tr·ª•c t·ªça ƒë·ªô: ƒê·ªânh parabol t·∫°i $I(0; 4)$. Ch√¢n c·ªïng t·∫°i $A(-2; 0)$ v√† $B(2; 0)$ (v√¨ r·ªông 4m).<br>Ph∆∞∆°ng tr√¨nh parabol c√≥ ƒë·ªânh $I(0; 4)$: $y = a x^2 + 4$.<br>Qua ƒëi·ªÉm $(2; 0) \\Rightarrow 0 = a(2^2) + 4 \\Rightarrow 4a = -4 \\Rightarrow a = -1$.<br>V·∫≠y $y = -x^2 + 4$.<br>ƒê∆∞a v·ªÅ d·∫°ng ch√≠nh t·∫Øc ƒë·ªÉ t√¨m ti√™u ƒëi·ªÉm: $x^2 = -(y - 4)$ hay $x^2 = -1(y-4)$.<br>D·∫°ng $X^2 = 4pY$ (v·ªõi h·ªá tr·ª•c d·ªùi v·ªÅ ƒë·ªânh). ·ªû ƒë√¢y $4p = 1 \\Rightarrow p = 1/4 = 0.25$.<br>Ti√™u ƒëi·ªÉm F c√°ch ƒë·ªânh m·ªôt ƒëo·∫°n $p = 0.25$ (n·∫±m ph√≠a d∆∞·ªõi ƒë·ªânh).<br>V·∫≠y b√≥ng ƒë√®n c√°ch ƒë·ªânh c·ªïng 0.25 m√©t." 
            },
            { 
                id: 'p3_q3', type: 'text', 
                question: "√îng An g·ª≠i 100 tri·ªáu ƒë·ªìng v√†o ng√¢n h√†ng theo th·ªÉ th·ª©c l√£i k√©p v·ªõi l√£i su·∫•t 6%/nƒÉm. Gi·∫£ s·ª≠ l√£i su·∫•t kh√¥ng thay ƒë·ªïi, h·ªèi sau √≠t nh·∫•t bao nhi√™u nƒÉm th√¨ s·ªë ti·ªÅn c·∫£ g·ªëc v√† l√£i c·ªßa √¥ng An v∆∞·ª£t qu√° 150 tri·ªáu ƒë·ªìng?", 
                acceptable: ["7"], 
                explanation: "C√¥ng th·ª©c l√£i k√©p: $A = P(1 + r)^n$.<br>$150 < 100(1 + 0.06)^n \\Leftrightarrow 1.5 < (1.06)^n$.<br>$n > \\log_{1.06}(1.5) \\approx 6.96$.<br>V√¨ n l√† s·ªë nguy√™n (nƒÉm) n√™n n = 7." 
            },
            { 
                id: 'p3_q4', type: 'text', 
                question: "Trong kh√¥ng gian $Oxyz$, cho h√¨nh h·ªôp $ABCD.A'B'C'D'$ c√≥ $A(0;0;0)$, $B(3;0;0)$, $D(0;4;0)$, $A'(0;0;5)$. T√≠nh kho·∫£ng c√°ch t·ª´ ƒëi·ªÉm $A'$ ƒë·∫øn m·∫∑t ph·∫≥ng $(A B' D')$. (L√†m tr√≤n ƒë·∫øn h√†ng ph·∫ßn m∆∞·ªùi).", 
                acceptable: ["2.2"], 
                explanation: "H√¨nh h·ªôp ch·ªØ nh·∫≠t (do c√°c t·ªça ƒë·ªô n·∫±m tr√™n tr·ª•c).<br>$A(0;0;0)$, $B'(3;0;5)$, $D'(0;4;5)$.<br>M·∫∑t ph·∫≥ng $(A B' D')$ ƒëi qua $A(0;0;0)$ v√† c√≥ c·∫∑p VTCP $\\vec{u_1} = \\vec{AB'} = (3;0;5)$, $\\vec{u_2} = \\vec{AD'} = (0;4;5)$.<br>VTPT $\\vec{n} = [\\vec{u_1}, \\vec{u_2}] = (-20; -15; 12)$.<br>Ph∆∞∆°ng tr√¨nh mp: $-20x - 15y + 12z = 0$.<br>Kho·∫£ng c√°ch t·ª´ $A'(0;0;5)$ ƒë·∫øn mp:<br>$d = \\frac{|-20(0) - 15(0) + 12(5)|}{\\sqrt{(-20)^2 + (-15)^2 + 12^2}} = \\frac{60}{\\sqrt{769}} \\approx 2.16$.<br>L√†m tr√≤n h√†ng ph·∫ßn m∆∞·ªùi: 2.2." 
            },
            { 
                id: 'p3_q5', type: 'text', 
                question: "S·ªë l∆∞·ª£ng vi khu·∫©n trong m·ªôt m·∫ª nu√¥i c·∫•y tu√¢n theo quy lu·∫≠t $N(t) = 500 \\cdot e^{0.2t}$, trong ƒë√≥ $t$ l√† th·ªùi gian t√≠nh b·∫±ng gi·ªù. T√≠nh t·ªëc ƒë·ªô tƒÉng tr∆∞·ªüng t·ª©c th·ªùi c·ªßa s·ªë l∆∞·ª£ng vi khu·∫©n t·∫°i th·ªùi ƒëi·ªÉm $t = 10$ gi·ªù. (L√†m tr√≤n k·∫øt qu·∫£ ƒë·∫øn h√†ng ƒë∆°n v·ªã).", 
                acceptable: ["739"], 
                explanation: "T·ªëc ƒë·ªô tƒÉng tr∆∞·ªüng t·ª©c th·ªùi l√† ƒë·∫°o h√†m $N'(t)$.<br>$N'(t) = 500 \\cdot 0.2 \\cdot e^{0.2t} = 100 \\cdot e^{0.2t}$.<br>T·∫°i $t = 10$: $N'(10) = 100 \\cdot e^{2} \\approx 100 \\cdot 7.389 = 738.9$.<br>L√†m tr√≤n h√†ng ƒë∆°n v·ªã: 739." 
            },
            { 
                id: 'p3_q6', type: 'text', 
                question: "M·ªôt h·ªôp ch·ª©a 5 qu·∫£ c·∫ßu ƒë·ªè v√† 4 qu·∫£ c·∫ßu xanh. L·∫•y ng·∫´u nhi√™n ƒë·ªìng th·ªùi 3 qu·∫£ c·∫ßu. T√≠nh x√°c su·∫•t ƒë·ªÉ l·∫•y ƒë∆∞·ª£c √≠t nh·∫•t 1 qu·∫£ c·∫ßu ƒë·ªè. (Nh·∫≠p k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng s·ªë th·∫≠p ph√¢n, l√†m tr√≤n ƒë·∫øn h√†ng ph·∫ßn trƒÉm).", 
                acceptable: ["0.95"], 
                explanation: "T·ªïng s·ªë qu·∫£: 9. Ch·ªçn 3 qu·∫£: $C_9^3 = 84$ c√°ch.<br>D√πng bi·∫øn c·ªë ƒë·ªëi: 'Kh√¥ng l·∫•y ƒë∆∞·ª£c qu·∫£ ƒë·ªè n√†o' (t·ª©c l√† l·∫•y 3 qu·∫£ xanh).<br>S·ªë qu·∫£ xanh: 4. S·ªë c√°ch ch·ªçn 3 xanh: $C_4^3 = 4$.<br>P(to√†n xanh) = $4/84 = 1/21$.<br>P(√≠t nh·∫•t 1 ƒë·ªè) = $1 - 1/21 = 20/21 \\approx 0.9523$.<br>L√†m tr√≤n h√†ng ph·∫ßn trƒÉm: 0.95." 
            }
        ];
        
        // --- LOGIC T√çNH ƒêI·ªÇM ---
        const calculateScore = (currentQuestions, answers) => {
            let score = 0;
            let totalMaxScore = 0; 

            currentQuestions.forEach(q => {
                let questionMaxScore = 0;
                let questionScore = 0;

                if (q.type === 'mcq') {
                    questionMaxScore = 0.25; 
                    if (answers[q.id] === q.correct) questionScore = 0.25;
                } else if (q.type === 'text') {
                    questionMaxScore = 0.5; 
                    const userAns = (answers[q.id] || "").trim();
                    if (q.acceptable.includes(userAns)) questionScore = 0.5;
                } else if (q.type === 'group_tf') {
                    questionMaxScore = 1.0; 
                    let correctCount = 0;
                    const userGroupAns = answers[q.id] || {};
                    q.subQuestions.forEach(sub => {
                        if (userGroupAns[sub.id] === sub.correct) correctCount++;
                    });
                    if (correctCount === 1) questionScore = 0.1;
                    else if (correctCount === 2) questionScore = 0.25;
                    else if (correctCount === 3) questionScore = 0.5;
                    else if (correctCount === 4) questionScore = 1.0;
                }
                
                score += questionScore;
                totalMaxScore += questionMaxScore;
            });
            
            if (totalMaxScore > 0) {
                 const scaledScore = (score / totalMaxScore) * 10;
                 return Math.round(scaledScore * 100) / 100;
            }
            return 0;
        };
        
        // --- M√ÄN H√åNH CH√ÄO ---
        const WelcomeScreen = ({ onSelectMode }) => (
            <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-cyan-600 to-blue-800 p-4 text-white animate-fade-in">
                <div className="bg-white/10 backdrop-blur-md p-8 rounded-2xl shadow-2xl max-w-md w-full text-center border border-white/20">
                    <h1 className="text-4xl font-bold mb-2">TRANDAIEDU</h1>
                    <h2 className="text-xl mb-8 text-cyan-100 font-medium">ƒê·ªÄ THI TH·ª¨ T·ªêT NGHI·ªÜP THPT 2025</h2>
                    <h3 className="text-lg mb-4 text-white font-bold bg-blue-600/50 py-1 rounded">M√îN TO√ÅN - ƒê·ªÄ S·ªê 01</h3>
                    <div className="space-y-4">
                        <button onClick={() => onSelectMode('student')} className="w-full py-4 bg-white text-blue-800 rounded-xl font-bold hover:bg-blue-50 transition-all shadow-lg flex items-center justify-center gap-2"><Icon name="user"/> H·ªçc Sinh V√†o Thi</button>
                        <button onClick={() => onSelectMode('teacher')} className="w-full py-4 bg-blue-900/50 text-white rounded-xl font-bold hover:bg-blue-900 transition-all border border-blue-400/30 flex items-center justify-center gap-2"><Icon name="lock"/> Gi√°o Vi√™n Xem ƒêi·ªÉm</button>
                    </div>
                </div>
            </div>
        );

        // --- NH·∫¨P T√äN ---
        const StudentNameInput = ({ onStart }) => {
            const [name, setName] = useState('');
            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4 animate-fade-in">
                    <form onSubmit={(e) => { e.preventDefault(); if(name.trim()) onStart(name); }} className="bg-white p-8 rounded-2xl shadow-xl max-w-sm w-full">
                        <h2 className="text-2xl font-bold text-gray-800 mb-2 text-center">Nh·∫≠p Th√¥ng Tin</h2>
                        <div className="mb-6">
                            <input type="text" value={name} onChange={(e) => setName(e.target.value)} className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500" placeholder="H·ªç v√† t√™n..." required />
                        </div>
                        <button type="submit" className="w-full py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition-colors">B·∫Øt ƒê·∫ßu</button>
                    </form>
                </div>
            );
        };

        // --- L√ÄM B√ÄI THI ---
        const QuizView = ({ studentName, questions, onSubmit }) => {
            const [answers, setAnswers] = useState({});
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [showConfirmModal, setShowConfirmModal] = useState(false);

            useEffect(() => { window.scrollTo(0, 0); }, []);
            
            const handleMcqChange = (qId, optIdx) => setAnswers(prev => ({ ...prev, [qId]: optIdx }));
            const handleTfChange = (qId, subId, val) => setAnswers(prev => ({ ...prev, [qId]: { ...(prev[qId] || {}), [subId]: val } }));
            const handleTextChange = (qId, val) => setAnswers(prev => ({ ...prev, [qId]: val }));
            
            const handleConfirmSubmit = async () => {
                setShowConfirmModal(false);
                setIsSubmitting(true);
                onSubmit(answers);
            };

            return (
                <div className="min-h-screen bg-gray-100 pb-20 relative">
                    <div className="bg-white shadow-md p-4 sticky top-0 z-10 border-b border-gray-200">
                        <div className="max-w-3xl mx-auto flex justify-between items-center">
                            <div className="font-bold text-blue-700 flex items-center gap-2"><Icon name="user" size={18}/> {studentName}</div>
                        </div>
                    </div>

                    <div className="max-w-3xl mx-auto p-4 space-y-8 mt-4 animate-fade-in">
                        {questions.map((q, idx) => (
                            <div key={q.id} className="bg-white rounded-xl shadow-sm p-6 transition-all hover:shadow-md">
                                <div className="mb-3">
                                    <span className={`inline-block text-xs font-bold px-2 py-1 rounded mb-2 ${q.type === 'mcq' ? 'bg-blue-100 text-blue-800' : q.type === 'group_tf' ? 'bg-purple-100 text-purple-800' : 'bg-orange-100 text-orange-800'}`}>
                                        {q.type === 'mcq' ? 'Ph·∫ßn 1: Tr·∫Øc nghi·ªám' : q.type === 'group_tf' ? 'Ph·∫ßn 2: ƒê√∫ng/Sai' : 'Ph·∫ßn 3: Tr·∫£ l·ªùi ng·∫Øn'}
                                    </span>
                                    <div className="font-medium text-gray-800 flex gap-2">
                                        <span className="font-bold text-blue-600 whitespace-nowrap">C√¢u {idx + 1}:</span>
                                        <MathText text={q.question} />
                                    </div>
                                    {q.image && <div className="mt-3 flex justify-center">{q.image}</div>}
                                </div>
                                {q.type === 'mcq' && (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        {q.options.map((opt, optIdx) => (
                                            <button key={optIdx} onClick={() => handleMcqChange(q.id, optIdx)} className={`p-3 text-left rounded-lg border text-sm transition-all ${answers[q.id] === optIdx ? 'bg-blue-100 border-blue-500 text-blue-800 font-medium ring-1 ring-blue-500' : 'hover:bg-gray-50 border-gray-200'}`}>
                                                <span className="font-bold mr-2">{String.fromCharCode(65 + optIdx)}.</span><MathText text={opt} />
                                            </button>
                                        ))}
                                    </div>
                                )}
                                {q.type === 'group_tf' && (
                                    <div className="border rounded-lg overflow-hidden">
                                        <table className="w-full text-sm">
                                            <thead className="bg-gray-100"><tr><th className="p-3 text-left">M·ªánh ƒë·ªÅ</th><th className="p-3 w-16 text-center">ƒê√∫ng</th><th className="p-3 w-16 text-center">Sai</th></tr></thead>
                                            <tbody className="divide-y">
                                                {q.subQuestions.map(sub => {
                                                    const currentVal = (answers[q.id] || {})[sub.id];
                                                    return (
                                                        <tr key={sub.id} className="hover:bg-gray-50">
                                                            <td className="p-3"><MathText text={sub.text} /></td>
                                                            <td className="p-3 text-center"><input type="radio" name={`${q.id}-${sub.id}`} checked={currentVal === true} onChange={() => handleTfChange(q.id, sub.id, true)} className="w-5 h-5 cursor-pointer accent-blue-600"/></td>
                                                            <td className="p-3 text-center"><input type="radio" name={`${q.id}-${sub.id}`} checked={currentVal === false} onChange={() => handleTfChange(q.id, sub.id, false)} className="w-5 h-5 cursor-pointer accent-red-600"/></td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                                {q.type === 'text' && (
                                    <input type="text" value={answers[q.id] || ''} onChange={(e) => handleTextChange(q.id, e.target.value)} className="w-full md:w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Nh·∫≠p ƒë√°p √°n (s·ªë th·∫≠p ph√¢n)..." />
                                )}
                            </div>
                        ))}
                        <div className="flex justify-center pt-6">
                            <button onClick={() => setShowConfirmModal(true)} disabled={isSubmitting} className={`px-8 py-4 text-white text-lg font-bold rounded-xl shadow-lg flex items-center gap-2 transition-all ${isSubmitting ? 'bg-gray-400 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700 transform hover:scale-105'}`}>
                                {isSubmitting ? <><Icon name="loader" className="animate-spin"/> ƒêANG G·ª¨I...</> : <><Icon name="save"/> N·ªòP B√ÄI</>}
                            </button>
                        </div>
                    </div>

                    {showConfirmModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
                            <div className="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 text-center animate-fade-in">
                                <h3 className="text-lg font-bold text-gray-900 mb-2">X√°c nh·∫≠n n·ªôp b√†i</h3>
                                <p className="text-sm text-gray-500 mb-6">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i thi?</p>
                                <div className="flex gap-3 justify-center">
                                    <button onClick={() => setShowConfirmModal(false)} className="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg font-medium hover:bg-gray-300 transition-colors">H·ªßy b·ªè</button>
                                    <button onClick={handleConfirmSubmit} className="px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition-colors shadow-lg">ƒê·ªìng √Ω n·ªôp</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- K·∫æT QU·∫¢ & L·ªúI GI·∫¢I ---
        const SolutionView = ({ questions, answers, score, onRetry }) => {
            const [openExplain, setOpenExplain] = useState({});
            const toggleExplain = (id) => setOpenExplain(prev => ({ ...prev, [id]: !prev[id] }));

            return (
                <div className="min-h-screen pb-20 animate-fade-in bg-gray-50">
                    <div className="bg-white shadow p-6 text-center mb-6">
                        <div className="flex justify-center mb-2"><Icon name="trophy" size={56} className="text-yellow-500"/></div>
                        <h2 className="text-2xl font-bold text-gray-800">K·∫øt Qu·∫£ B√†i Thi</h2>
                        <div className="mt-4 inline-block px-6 py-3 rounded-xl border bg-blue-50 border-blue-200">
                            <span className="text-gray-600 uppercase text-xs font-bold block">T·ªïng ƒêi·ªÉm</span>
                            <span className="text-4xl font-bold text-blue-700">{score.toFixed(2)}<span className="text-xl text-gray-500">/10</span></span>
                        </div>
                    </div>

                    <div className="max-w-3xl mx-auto p-4 space-y-6">
                        <h3 className="font-bold text-gray-700 flex items-center gap-2 mb-4"><Icon name="check-circle" size={20}/> Chi Ti·∫øt L·ªùi Gi·∫£i</h3>
                        {questions.map((q, idx) => {
                            const isOpen = openExplain[q.id];
                            return (
                                <div key={q.id} className="bg-white rounded-lg shadow-sm border-l-4 border-blue-400 overflow-hidden">
                                    <div className="p-4 cursor-pointer hover:bg-gray-50 transition-colors" onClick={() => toggleExplain(q.id)}>
                                        <div className="flex justify-between items-start">
                                            <div className="font-medium text-gray-800 flex-1 flex gap-2"><span className="font-bold whitespace-nowrap">C√¢u {idx + 1}:</span> <MathText text={q.question} /></div>
                                        </div>
                                        <div className="text-right text-xs text-blue-500 mt-2 font-medium flex items-center justify-end gap-1">{isOpen ? 'Thu g·ªçn' : 'Xem chi ti·∫øt'} <Icon name={isOpen ? "chevron-up" : "chevron-down"} size={14}/></div>
                                    </div>
                                    {isOpen && (
                                        <div className="bg-blue-50 p-4 text-sm text-blue-900 border-t border-blue-100">
                                            {q.image && <div className="mb-4 flex justify-center">{q.image}</div>}
                                            <span className="font-bold block mb-1">üí° L·ªùi gi·∫£i chi ti·∫øt:</span>
                                            <MathText text={q.explanation} />
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                    <div className="flex justify-center pt-6 pb-10">
                        <button onClick={onRetry} className="px-8 py-3 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 shadow-lg flex items-center gap-2"><Icon name="refresh-ccw"/> L√†m l·∫°i ƒë·ªÅ m·ªõi</button>
                    </div>
                </div>
            );
        };

        // --- GI√ÅO VI√äN ---
        const TeacherLogin = ({ onLogin, onBack }) => {
            const [pass, setPass] = useState('');
            const handleLogin = (e) => { e.preventDefault(); if (pass === '12345678T') onLogin(); };
            return ( <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4 animate-fade-in"> <div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm"> <h2 className="text-xl font-bold mb-6 text-gray-800 text-center">Gi√°o Vi√™n ƒêƒÉng Nh·∫≠p</h2> <form onSubmit={handleLogin} className="space-y-4"> <input type="password" value={pass} onChange={(e) => setPass(e.target.value)} className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." autoFocus/> <button type="submit" className="w-full py-3 bg-blue-700 text-white rounded-lg font-bold hover:bg-blue-800">Truy c·∫≠p</button> <button type="button" onClick={onBack} className="w-full py-2 text-gray-500 hover:text-gray-800 text-sm">Quay l·∫°i</button> </form> </div> </div> );
        };

        const TeacherDashboard = ({ onLogout }) => {
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                if (!db) { setLoading(false); return; }
                const unsubscribe = db.collection(COLLECTION_NAME).orderBy('timestamp', 'desc').onSnapshot((snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setResults(data);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            return (
                <div className="min-h-screen bg-gray-50 animate-fade-in">
                    <div className="bg-white shadow px-6 py-4 flex justify-between items-center sticky top-0 z-10">
                        <h1 className="text-xl font-bold text-gray-800 flex items-center gap-2"><Icon name="list" className="text-blue-600"/> B·∫£ng ƒêi·ªÉm</h1>
                        <button onClick={onLogout} className="text-red-600 hover:bg-red-50 px-4 py-2 rounded-lg flex items-center gap-2 font-medium"><Icon name="log-out" size={18}/> ƒêƒÉng xu·∫•t</button>
                    </div>
                    <div className="max-w-6xl mx-auto p-6">
                        <div className="bg-white rounded-xl shadow overflow-hidden">
                            <table className="w-full">
                                <thead className="bg-gray-100 border-b"><tr><th className="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase">Th·ªùi gian</th><th className="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase">H·ªç v√† T√™n</th><th className="px-6 py-4 text-center text-xs font-bold text-gray-500 uppercase">ƒêi·ªÉm S·ªë</th></tr></thead>
                                <tbody className="divide-y divide-gray-200">
                                    {loading ? <tr><td colSpan="3" className="p-8 text-center">ƒêang t·∫£i...</td></tr> : results.map((res) => (
                                        <tr key={res.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 text-sm text-gray-500">{new Date(res.timestamp).toLocaleString('vi-VN')}</td>
                                            <td className="px-6 py-4 font-medium text-gray-900">{res.name}</td>
                                            <td className="px-6 py-4 text-center"><span className="text-lg font-bold text-blue-700">{res.score?.toFixed(2)}</span></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        // --- APP CH√çNH ---
        const App = () => {
            const [view, setView] = useState('welcome');
            const [studentName, setStudentName] = useState('');
            const [currentQuestions, setCurrentQuestions] = useState([]);
            const [finalScore, setFinalScore] = useState(0);
            const [userAnswers, setUserAnswers] = useState({});

            useEffect(() => {
                if (auth) auth.signInAnonymously().catch(console.error);
            }, []);

            const startNewQuiz = (name) => {
                setStudentName(name);
                setCurrentQuestions(QUESTION_BANK); // S·ª≠ d·ª•ng to√†n b·ªô c√¢u h·ªèi theo th·ª© t·ª±
                setView('quiz');
            };

            const handleSubmitQuiz = async (answers) => {
                const score = calculateScore(currentQuestions, answers);
                setFinalScore(score);
                setUserAnswers(answers);
                
                if (db && auth && auth.currentUser) {
                    db.collection(COLLECTION_NAME).add({
                        name: studentName, 
                        score: score, 
                        answers: answers, 
                        timestamp: new Date().toISOString()
                    });
                }
                setView('result'); 
            };

            return (
                <div>
                    {view === 'welcome' && <WelcomeScreen onSelectMode={(mode) => setView(mode === 'student' ? 'name' : 'login')} />}
                    {view === 'name' && <StudentNameInput onStart={startNewQuiz} />}
                    {view === 'quiz' && <QuizView studentName={studentName} questions={currentQuestions} onSubmit={handleSubmitQuiz} />}
                    {view === 'result' && <SolutionView questions={currentQuestions} answers={userAnswers} score={finalScore} onRetry={() => startNewQuiz(studentName)} />}
                    {view === 'login' && <TeacherLogin onLogin={() => setView('teacher')} onBack={() => setView('welcome')} />}
                    {view === 'teacher' && <TeacherDashboard onLogout={() => setView('welcome')} />}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
